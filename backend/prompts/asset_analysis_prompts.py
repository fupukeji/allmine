"""
AIèµ„äº§åˆ†ææç¤ºè¯é…ç½®
æŒ‰ç…§å®é™…äººä»¬æƒ³è¦äº†è§£çš„å†…å®¹è®¾è®¡,åˆ†æå¸ˆè§’è‰²æ˜ç¡®,æŒ‡ä»¤æ¸…æ™°
ç‰ˆæœ¬: 1.0.0
"""

PROMPT_VERSION = "1.0.0"


def get_system_prompt():
    """
    è·å–ç³»ç»Ÿè§’è‰²å®šä¹‰ - æ˜ç¡®åˆ†æå¸ˆèº«ä»½å’ŒèŒè´£
    """
    return """ä½ æ˜¯ä¸€ä½èµ„æ·±çš„ä¸ªäººè´¢å¯Œç®¡ç†é¡¾é—®,ä¸“é—¨å¸®åŠ©å®¢æˆ·åˆ†æå’Œä¼˜åŒ–èµ„äº§é…ç½®ã€‚

ä½ çš„æ ¸å¿ƒèƒ½åŠ›:
1. ç²¾å‡†è§£è¯»è´¢åŠ¡æ•°æ®,å‘ç°æ·±å±‚æ¬¡é—®é¢˜å’Œæœºä¼š
2. æä¾›åŸºäºæ•°æ®çš„ä¸“ä¸šæ´å¯Ÿå’Œå¯æ‰§è¡Œå»ºè®®
3. ç”¨æ¸…æ™°ç®€æ´çš„è¯­è¨€è§£é‡Šå¤æ‚çš„è´¢åŠ¡æ¦‚å¿µ
4. å…³æ³¨å®¢æˆ·çœŸå®éœ€æ±‚,æä¾›ä¸ªæ€§åŒ–çš„èµ„äº§ç®¡ç†æ–¹æ¡ˆ

ä½ çš„å·¥ä½œåŸåˆ™:
- åŸºäºçœŸå®æ•°æ®åˆ†æ,ç»ä¸ç¼–é€ æ•°å­—
- çªå‡ºå…³é”®ä¿¡æ¯,æ ‡æ³¨é£é™©ç‚¹å’Œæœºä¼šç‚¹
- å»ºè®®å…·ä½“å¯æ‰§è¡Œ,åŒ…å«æ—¶é—´è¡¨å’Œé¢„æœŸæ•ˆæœ
- è¯­è¨€é€šä¿—æ˜“æ‡‚,é¿å…è¿‡åº¦ä¸“ä¸šæœ¯è¯­"""


def get_asset_analysis_prompt(data_text, analysis_focus="ç»¼åˆåˆ†æ"):
    """
    è·å–èµ„äº§åˆ†ææç¤ºè¯
    
    Args:
        data_text: æ ¼å¼åŒ–åçš„èµ„äº§æ•°æ®æ–‡æœ¬
        analysis_focus: åˆ†æé‡ç‚¹ (ç»¼åˆåˆ†æ/å›ºå®šèµ„äº§/è™šæ‹Ÿèµ„äº§/æ”¶ç›Šåˆ†æ)
    
    Returns:
        å®Œæ•´çš„åˆ†ææç¤ºè¯
    """
    return f"""è¯·åŸºäºä»¥ä¸‹èµ„äº§æ•°æ®,è¿›è¡Œ{analysis_focus}ã€‚

===== èµ„äº§æ•°æ® =====
{data_text}

===== åˆ†æè¦æ±‚ =====

**ä½ éœ€è¦å…³æ³¨çš„å…³é”®é—®é¢˜**:
1. ğŸ’° èµ„äº§å¥åº·åº¦ - å›ºå®šèµ„äº§æ˜¯å¦åœ¨æœ‰æ•ˆä½¿ç”¨?æŠ˜æ—§æ˜¯å¦åˆç†?
2. ğŸ“Š è™šæ‹Ÿèµ„äº§åˆ©ç”¨ç‡ - é¢„ä»˜æƒç›Šæ˜¯å¦è¢«å……åˆ†ä½¿ç”¨?æµªè´¹ç‡æ˜¯å¦è¿‡é«˜?
3. ğŸ’µ æ”¶ç›Šè¡¨ç° - èµ„äº§äº§ç”Ÿçš„æ”¶å…¥æ˜¯å¦è¾¾åˆ°é¢„æœŸ?å“ªäº›èµ„äº§å›æŠ¥æœ€å¥½?
4. âš ï¸ é£é™©é¢„è­¦ - å³å°†è¿‡æœŸçš„é¡¹ç›®?ä½¿ç”¨ç‡ä½çš„èµ„äº§?
5. ğŸ¯ ä¼˜åŒ–æœºä¼š - å“ªäº›åœ°æ–¹å¯ä»¥æå‡æ•ˆç‡?å¦‚ä½•å‡å°‘æµªè´¹?

**è¾“å‡ºæ ¼å¼è¦æ±‚**:
è¿”å›ä¸€ä¸ªJSONå¯¹è±¡,åŒ…å«ä»¥ä¸‹å­—æ®µ:

{{
    "summary": "æ ¸å¿ƒå‘ç°æ€»ç»“(200å­—ä»¥å†…,çªå‡ºæœ€é‡è¦çš„3ä¸ªå‘ç°)",
    
    "fixed_assets": {{
        "health_score": å¥åº·è¯„åˆ†(0-100),
        "key_findings": [
            "å‘ç°1:å…·ä½“èµ„äº§+æ•°æ®+é—®é¢˜/äº®ç‚¹",
            "å‘ç°2:..."
        ],
        "recommendations": [
            "å»ºè®®1:å…·ä½“è¡ŒåŠ¨+é¢„æœŸæ•ˆæœ",
            "å»ºè®®2:..."
        ]
    }},
    
    "virtual_assets": {{
        "utilization_score": åˆ©ç”¨ç‡è¯„åˆ†(0-100),
        "waste_analysis": "æµªè´¹åˆ†æ:TOP3æµªè´¹åˆ†ç±»+é‡‘é¢+åŸå› ",
        "expiring_alerts": [
            "é¡¹ç›®åç§° - å‰©ä½™Xå¤© - Â¥XX"
        ],
        "optimization_tips": [
            "ä¼˜åŒ–å»ºè®®1",
            "ä¼˜åŒ–å»ºè®®2"
        ]
    }},
    
    "income_analysis": {{
        "total_income": æ€»æ”¶å…¥é‡‘é¢,
        "income_structure": [
            {{"source": "æ¥æº", "amount": é‡‘é¢, "percentage": å æ¯”}}
        ],
        "performance_review": "æ”¶å…¥è¡¨ç°è¯„ä»·"
    }},
    
    "risk_alerts": [
        {{
            "level": "é«˜/ä¸­/ä½",
            "type": "é£é™©ç±»å‹",
            "description": "é£é™©æè¿°",
            "solution": "åº”å¯¹æ–¹æ¡ˆ"
        }}
    ],
    
    "action_plan": [
        {{
            "priority": "é«˜/ä¸­/ä½",
            "action": "å…·ä½“è¡ŒåŠ¨",
            "timeline": "æ—¶é—´è¡¨",
            "expected_result": "é¢„æœŸæ•ˆæœ"
        }}
    ],
    
    "chart_insights": {{
        "asset_allocation": "èµ„äº§é…ç½®åˆ†æ",
        "trend_observation": "è¶‹åŠ¿è§‚å¯Ÿ",
        "comparison_note": "å¯¹æ¯”è¯´æ˜(å¦‚æœ‰ä¸ŠæœŸæ•°æ®)"
    }}
}}

**é‡è¦æç¤º**:
1. æ‰€æœ‰é‡‘é¢å¿…é¡»æ˜¯å…·ä½“æ•°å­—,ä¸è¦ä½¿ç”¨XXå ä½ç¬¦
2. ç™¾åˆ†æ¯”ä¿ç•™1ä½å°æ•°
3. å‘ç°å’Œå»ºè®®è¦å…·ä½“,åŒ…å«æ•°æ®æ”¯æ’‘
4. é£é™©å’Œæœºä¼šéƒ½è¦æ˜ç¡®æŒ‡å‡º
5. ç¡®ä¿JSONæ ¼å¼æ­£ç¡®,æ‰€æœ‰å¼•å·ã€æ‹¬å·ã€é€—å·åŒ¹é…
6. ä¸è¦è¾“å‡º```json```ä»£ç å—æ ‡è®°,ç›´æ¥è¿”å›JSONå¯¹è±¡

è¯·å¼€å§‹åˆ†æ:"""


def get_weekly_report_prompt(data_text, previous_data_text=""):
    """
    è·å–å‘¨æŠ¥ç”Ÿæˆæç¤ºè¯ - å®Œå…¨é’ˆå¯¹è´¨é‡è¯„ä¼°èŠ‚ç‚¹ä¼˜åŒ–
    
    è¯„ä¼°æ ‡å‡†ï¼ˆæ¥è‡ªnodes.pyçš„evaluate_quality_nodeï¼‰:
    1. JSONæœ‰æ•ˆæ€§ (30%): å¿…é¡»æ˜¯åˆæ³•çš„JSONæ ¼å¼
    2. å®Œæ•´æ€§ (40%): å¿…é¡»åŒ…å«å…¨éƒ¨10ä¸ªå¿…å¡«å­—æ®µ
    3. æ•°æ®å‡†ç¡®æ€§ (30%): å†…å®¹ä¸­å¿…é¡»åŒ…å«æ•°å­—
    
    åˆæ ¼çº¿: total_score >= 80
    
    10ä¸ªå¿…å¡«å­—æ®µ:
    - executive_summary
    - key_conclusions
    - fixed_asset_analysis
    - virtual_asset_analysis
    - income_performance
    - asset_allocation_review
    - actionable_recommendations
    - risk_alerts
    - health_score
    - chart_data
    """
    from datetime import datetime
    generate_time = datetime.now().strftime('%Yå¹´%mæœˆ%dæ—¥ %H:%M')
    
    comparison_section = ""
    if previous_data_text:
        comparison_section = f"""

## ä¸ŠæœŸæ•°æ®å¯¹æ¯”
{previous_data_text}

è¯·è®¡ç®—ç¯æ¯”å˜åŒ–å¹¶ç”¨ğŸ“ˆğŸ“‰è¡¨ç¤ºè¶‹åŠ¿ã€‚
"""
    
    return f"""ä½ æ˜¯ä¸€åä¸“ä¸šçš„ä¸ªäººè´¢å¯Œç®¡ç†é¡¾é—®ï¼Œè¯·åŸºäºä»¥ä¸‹æ•°æ®ç”Ÿæˆä¸€ä»½èµ„äº§å‘¨æŠ¥ã€‚

# åŸå§‹æ•°æ®
{data_text}{comparison_section}

# è¾“å‡ºè¦æ±‚

âš ï¸ **å…³é”®è§„åˆ™ - å¿…é¡»ä¸¥æ ¼éµå®ˆ**:

1. **JSONæ ¼å¼è§„èŒƒ** (å½±å“30%è¯„åˆ†):
   - ç›´æ¥è¿”å›JSONå¯¹è±¡ï¼Œç¦æ­¢æ·»åŠ ```json```æ ‡è®°
   - æ‰€æœ‰å­—ç¬¦ä¸²ç”¨åŒå¼•å·
   - æ•°å­—ç±»å‹ä¸åŠ å¼•å·ï¼ˆä¾‹: 100 è€Œé "100"ï¼‰
   - ç¡®ä¿æ‰€æœ‰æ‹¬å·ã€é€—å·å®Œå…¨åŒ¹é…

2. **å­—æ®µå®Œæ•´æ€§** (å½±å“40%è¯„åˆ†):
   - å¿…é¡»åŒ…å«è¿™10ä¸ªå­—æ®µï¼š
     âœ“ executive_summary
     âœ“ key_conclusions
     âœ“ fixed_asset_analysis
     âœ“ virtual_asset_analysis
     âœ“ income_performance
     âœ“ asset_allocation_review
     âœ“ actionable_recommendations
     âœ“ risk_alerts
     âœ“ health_score
     âœ“ chart_data
   - ç¼ºå°‘ä»»ä½•ä¸€ä¸ªå­—æ®µå°†å¯¼è‡´è¯„åˆ†ä¸åˆæ ¼

3. **æ•°æ®å‡†ç¡®æ€§** (å½±å“30%è¯„åˆ†):
   - æ‰€æœ‰æ•°æ®å¿…é¡»ä»ä¸Šæ–¹åŸå§‹æ•°æ®ä¸­æå–
   - ç¦æ­¢ä½¿ç”¨XXã€XXXç­‰å ä½ç¬¦
   - å†…å®¹ä¸­å¿…é¡»åŒ…å«å¤§é‡çœŸå®æ•°å­—

# JSONç»“æ„

{{
  "executive_summary": {{
    "title": "æœ¬å‘¨æ ¸å¿ƒæ‘˜è¦",
    "content": "ç”¨150-200å­—æ€»ç»“æœ¬å‘¨æœ€é‡è¦çš„å‘ç°ï¼Œå¿…é¡»åŒ…å«å…·ä½“é‡‘é¢å’Œç™¾åˆ†æ¯”æ•°æ®"
  }},
  
  "key_conclusions": [
    "ç»“è®º1: åŸºäºæ•°æ®çš„å…³é”®å‘ç°ï¼ŒåŒ…å«å…·ä½“æ•°å­—",
    "ç»“è®º2: åŸºäºæ•°æ®çš„å…³é”®å‘ç°ï¼ŒåŒ…å«å…·ä½“æ•°å­—",
    "ç»“è®º3: åŸºäºæ•°æ®çš„å…³é”®å‘ç°ï¼ŒåŒ…å«å…·ä½“æ•°å­—"
  ],
  
  "fixed_asset_analysis": {{
    "total_count": å›ºå®šèµ„äº§æ•°é‡,
    "total_value": æ€»ä»·å€¼,
    "total_income": æ€»æ”¶å…¥,
    "categories": [
      {{
        "name": "åˆ†ç±»åç§°",
        "count": æ•°é‡,
        "value": ä»·å€¼,
        "income": æ”¶å…¥
      }}
    ],
    "analysis": "åŸºäºçœŸå®æ•°æ®çš„åˆ†ææ–‡å­—ï¼Œ100-200å­—"
  }},
  
  "virtual_asset_analysis": {{
    "total_projects": é¡¹ç›®æ•°,
    "total_investment": æ€»æŠ•å…¥,
    "utilization_rate": åˆ©ç”¨ç‡,
    "waste_rate": æµªè´¹ç‡,
    "top_waste": [
      {{
        "project_name": "é¡¹ç›®å",
        "waste_amount": æµªè´¹é‡‘é¢,
        "waste_percentage": æµªè´¹æ¯”ä¾‹
      }}
    ],
    "expiring_soon": [
      {{
        "project_name": "é¡¹ç›®å",
        "days_left": å‰©ä½™å¤©æ•°,
        "value": å‰©ä½™ä»·å€¼
      }}
    ],
    "analysis": "åŸºäºçœŸå®æ•°æ®çš„åˆ†ææ–‡å­—ï¼Œ100-200å­—"
  }},
  
  "income_performance": {{
    "total_income": æ€»æ”¶å…¥,
    "sources": [
      {{
        "source": "æ”¶å…¥æ¥æº",
        "amount": é‡‘é¢,
        "percentage": å æ¯”
      }}
    ],
    "analysis": "æ”¶å…¥è¡¨ç°åˆ†æï¼Œ100-150å­—"
  }},
  
  "asset_allocation_review": {{
    "total_assets": èµ„äº§æ€»å€¼,
    "fixed_assets_value": å›ºå®šèµ„äº§æ€»å€¼,
    "fixed_assets_percentage": å›ºå®šèµ„äº§å æ¯”,
    "virtual_assets_value": è™šæ‹Ÿèµ„äº§æ€»å€¼,
    "virtual_assets_percentage": è™šæ‹Ÿèµ„äº§å æ¯”,
    "analysis": "èµ„äº§é…ç½®åˆ†æï¼Œ80-120å­—"
  }},
  
  "actionable_recommendations": [
    {{
      "priority": "high",
      "title": "å»ºè®®æ ‡é¢˜",
      "description": "å…·ä½“è¡ŒåŠ¨æ­¥éª¤",
      "expected_result": "é¢„æœŸæ•ˆæœ"
    }},
    {{
      "priority": "medium",
      "title": "å»ºè®®æ ‡é¢˜",
      "description": "å…·ä½“è¡ŒåŠ¨æ­¥éª¤",
      "expected_result": "é¢„æœŸæ•ˆæœ"
    }},
    {{
      "priority": "low",
      "title": "å»ºè®®æ ‡é¢˜",
      "description": "å…·ä½“è¡ŒåŠ¨æ­¥éª¤",
      "expected_result": "é¢„æœŸæ•ˆæœ"
    }}
  ],
  
  "risk_alerts": [
    {{
      "level": "high",
      "type": "é£é™©ç±»å‹",
      "description": "é£é™©æè¿°ï¼ŒåŒ…å«å…·ä½“æ•°æ®",
      "impact": "å½±å“ç¨‹åº¦",
      "solution": "åº”å¯¹æ–¹æ¡ˆ"
    }}
  ],
  
  "health_score": {{
    "overall": æ€»ä½“å¾—åˆ†(0-100),
    "fixed_assets": å›ºå®šèµ„äº§å¾—åˆ†(0-100),
    "virtual_assets": è™šæ‹Ÿèµ„äº§å¾—åˆ†(0-100),
    "income": æ”¶å…¥è¡¨ç°å¾—åˆ†(0-100),
    "risk_control": é£é™©æ§åˆ¶å¾—åˆ†(0-100)
  }},
  
  "chart_data": {{
    "asset_allocation": [
      {{"name": "å›ºå®šèµ„äº§", "value": æ•°å€¼}},
      {{"name": "è™šæ‹Ÿèµ„äº§", "value": æ•°å€¼}}
    ],
    "income_trend": [
      {{"period": "å‘¨æœŸ", "amount": é‡‘é¢}}
    ],
    "utilization": {{
      "rate": åˆ©ç”¨ç‡,
      "waste": æµªè´¹ç‡
    }}
  }}
}}

# é‡è¦æç¤º

âœ… **å¿…é¡»åšåˆ°**:
- æ‰€æœ‰æ•°å­—å¿…é¡»æ˜¯çœŸå®æ•°æ®ï¼Œä»åŸå§‹æ•°æ®ä¸­è®¡ç®—å¾—å‡º
- health_scoreçš„æ¯ä¸ªç»´åº¦å¿…é¡»åŸºäºæ•°æ®è®¡ç®—
- actionable_recommendationsè‡³å°‘åŒ…å«3æ¡ï¼Œè¦†ç›–high/medium/lowä¼˜å…ˆçº§
- æ‰€æœ‰åˆ†ææ–‡å­—å¿…é¡»åŸºäºçœŸå®æ•°æ®ï¼Œä¸èƒ½ç©ºæ´

âŒ **ç»å¯¹ç¦æ­¢**:
- ä½¿ç”¨XXã€XXXã€[æ•°å­—]ç­‰å ä½ç¬¦
- è¿”å›```json```æˆ–```ä»£ç å—æ ‡è®°
- æ•°å€¼åŠ å¼•å·ï¼ˆé”™è¯¯ç¤ºä¾‹: "100"ï¼‰
- JSONæ ¼å¼é”™è¯¯ï¼ˆæ‹¬å·ä¸åŒ¹é…ã€é€—å·é—æ¼ç­‰ï¼‰
- ç¼ºå°‘ä»»ä½•ä¸€ä¸ªå¿…å¡«å­—æ®µ

# å¼€å§‹ç”Ÿæˆ

è¯·ç›´æ¥è¾“å‡ºJSONå¯¹è±¡ï¼Œä¸è¦æ·»åŠ ä»»ä½•å…¶ä»–å†…å®¹ï¼š"""


def get_monthly_report_prompt(data_text):
    """è·å–æœˆæŠ¥ç”Ÿæˆæç¤ºè¯"""
    weekly_prompt = get_weekly_report_prompt(data_text)
    return weekly_prompt.replace("å‘¨æŠ¥", "æœˆæŠ¥").replace("æœ¬å‘¨", "æœ¬æœˆ").replace("ä¸Šå‘¨", "ä¸Šæœˆ").replace("ä¸‹å‘¨", "ä¸‹æœˆ")


def get_yearly_report_prompt(data_text):
    """è·å–å¹´æŠ¥ç”Ÿæˆæç¤ºè¯"""
    weekly_prompt = get_weekly_report_prompt(data_text)
    return weekly_prompt.replace("å‘¨æŠ¥", "å¹´æŠ¥").replace("æœ¬å‘¨", "æœ¬å¹´").replace("ä¸Šå‘¨", "ä¸Šå¹´").replace("ä¸‹å‘¨", "æ˜å¹´")


def get_chart_data_prompt(ai_analysis_result):
    """
    æ ¹æ®AIåˆ†æç»“æœ,ç”Ÿæˆå›¾è¡¨æ•°æ®çš„æç¤ºè¯
    
    Args:
        ai_analysis_result: AIåˆ†æçš„JSONç»“æœ
    """
    return f"""åŸºäºä»¥ä¸‹åˆ†æç»“æœ,ç”Ÿæˆå‰ç«¯å›¾è¡¨æ‰€éœ€çš„æ•°æ®é…ç½®ã€‚

===== AIåˆ†æç»“æœ =====
{ai_analysis_result}

===== éœ€è¦ç”Ÿæˆçš„å›¾è¡¨ =====

è¯·è¿”å›ä¸€ä¸ªJSONå¯¹è±¡,åŒ…å«ä»¥ä¸‹å›¾è¡¨çš„æ•°æ®é…ç½®:

{{
    "asset_allocation_pie": [
        {{"name": "å›ºå®šèµ„äº§", "value": æ•°å€¼}},
        {{"name": "è™šæ‹Ÿèµ„äº§", "value": æ•°å€¼}}
    ],
    
    "fixed_asset_categories_bar": [
        {{"category": "åˆ†ç±»å", "value": ä»·å€¼, "count": æ•°é‡}}
    ],
    
    "virtual_asset_utilization_gauge": {{
        "utilization_rate": åˆ©ç”¨ç‡ç™¾åˆ†æ¯”,
        "waste_rate": æµªè´¹ç‡ç™¾åˆ†æ¯”
    }},
    
    "income_structure_pie": [
        {{"source": "æ¥æº", "amount": é‡‘é¢}}
    ],
    
    "health_score_radar": [
        {{"dimension": "å›ºå®šèµ„äº§", "score": å¾—åˆ†, "maxScore": 100}},
        {{"dimension": "è™šæ‹Ÿèµ„äº§", "score": å¾—åˆ†, "maxScore": 100}},
        {{"dimension": "æ”¶å…¥è¡¨ç°", "score": å¾—åˆ†, "maxScore": 100}},
        {{"dimension": "é£é™©æ§åˆ¶", "score": å¾—åˆ†, "maxScore": 100}}
    ]
}}

**è¦æ±‚**:
1. æ‰€æœ‰æ•°å€¼å¿…é¡»æ˜¯æ•°å­—ç±»å‹,ä¸æ˜¯å­—ç¬¦ä¸²
2. ç™¾åˆ†æ¯”ä¸è¦å¸¦%ç¬¦å·,ç›´æ¥æ•°å­—(å¦‚ 75 ä¸æ˜¯ "75%")
3. ç¡®ä¿JSONæ ¼å¼æ­£ç¡®
4. ä¸è¦è¾“å‡ºä»£ç å—æ ‡è®°

è¯·ç”Ÿæˆå›¾è¡¨æ•°æ®é…ç½®:"""
