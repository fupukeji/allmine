"""
AI资产分析提示词配置
按照实际人们想要了解的内容设计,分析师角色明确,指令清晰
版本: 1.0.0
"""

PROMPT_VERSION = "1.0.0"


def get_system_prompt():
    """
    获取系统角色定义 - 明确分析师身份和职责
    """
    return """你是一位资深的个人财富管理顾问,专门帮助客户分析和优化资产配置。

你的核心能力:
1. 精准解读财务数据,发现深层次问题和机会
2. 提供基于数据的专业洞察和可执行建议
3. 用清晰简洁的语言解释复杂的财务概念
4. 关注客户真实需求,提供个性化的资产管理方案

你的工作原则:
- 基于真实数据分析,绝不编造数字
- 突出关键信息,标注风险点和机会点
- 建议具体可执行,包含时间表和预期效果
- 语言通俗易懂,避免过度专业术语"""


def get_asset_analysis_prompt(data_text, analysis_focus="综合分析"):
    """
    获取资产分析提示词
    
    Args:
        data_text: 格式化后的资产数据文本
        analysis_focus: 分析重点 (综合分析/固定资产/虚拟资产/收益分析)
    
    Returns:
        完整的分析提示词
    """
    return f"""请基于以下资产数据,进行{analysis_focus}。

===== 资产数据 =====
{data_text}

===== 分析要求 =====

**你需要关注的关键问题**:
1. 💰 资产健康度 - 固定资产是否在有效使用?折旧是否合理?
2. 📊 虚拟资产利用率 - 预付权益是否被充分使用?浪费率是否过高?
3. 💵 收益表现 - 资产产生的收入是否达到预期?哪些资产回报最好?
4. ⚠️ 风险预警 - 即将过期的项目?使用率低的资产?
5. 🎯 优化机会 - 哪些地方可以提升效率?如何减少浪费?

**输出格式要求**:
返回一个JSON对象,包含以下字段:

{{
    "summary": "核心发现总结(200字以内,突出最重要的3个发现)",
    
    "fixed_assets": {{
        "health_score": 健康评分(0-100),
        "key_findings": [
            "发现1:具体资产+数据+问题/亮点",
            "发现2:..."
        ],
        "recommendations": [
            "建议1:具体行动+预期效果",
            "建议2:..."
        ]
    }},
    
    "virtual_assets": {{
        "utilization_score": 利用率评分(0-100),
        "waste_analysis": "浪费分析:TOP3浪费分类+金额+原因",
        "expiring_alerts": [
            "项目名称 - 剩余X天 - ¥XX"
        ],
        "optimization_tips": [
            "优化建议1",
            "优化建议2"
        ]
    }},
    
    "income_analysis": {{
        "total_income": 总收入金额,
        "income_structure": [
            {{"source": "来源", "amount": 金额, "percentage": 占比}}
        ],
        "performance_review": "收入表现评价"
    }},
    
    "risk_alerts": [
        {{
            "level": "高/中/低",
            "type": "风险类型",
            "description": "风险描述",
            "solution": "应对方案"
        }}
    ],
    
    "action_plan": [
        {{
            "priority": "高/中/低",
            "action": "具体行动",
            "timeline": "时间表",
            "expected_result": "预期效果"
        }}
    ],
    
    "chart_insights": {{
        "asset_allocation": "资产配置分析",
        "trend_observation": "趋势观察",
        "comparison_note": "对比说明(如有上期数据)"
    }}
}}

**重要提示**:
1. 所有金额必须是具体数字,不要使用XX占位符
2. 百分比保留1位小数
3. 发现和建议要具体,包含数据支撑
4. 风险和机会都要明确指出
5. 确保JSON格式正确,所有引号、括号、逗号匹配
6. 不要输出```json```代码块标记,直接返回JSON对象

请开始分析:"""


def get_weekly_report_prompt(data_text, previous_data_text=""):
    """
    获取周报生成提示词
    
    Args:
        data_text: 本周数据文本
        previous_data_text: 上周数据文本(可选)
    """
    comparison_hint = ""
    if previous_data_text:
        comparison_hint = f"""
**上周数据对比**:
{previous_data_text}

请在分析中标注周环比变化(用📈📉➡️表示趋势),重点关注:
- 资产价值变化及原因
- 收入增减趋势
- 利用率和浪费率的变化
- 新出现的问题或改善点
"""
    
    # 获取当前时间(作为报告生成时间)
    from datetime import datetime
    generate_time = datetime.now().strftime('%Y年%m月%d日 %H:%M')
    
    return f"""请生成一份专业、深入、易读的资产周报,帮助用户全面了解资产状况。

===== 本周数据 =====
{data_text}
{comparison_hint}

===== 报告结构与要求 =====

# 📊 资产周报

> 📅 报告期间: {{从数据中提取开始和结束日期}}  
> 📈 综合评级: {{根据整体表现给出A/B/C/D评级}} | 健康度: {{计算0-100分}}

---

## 📌 一、执行摘要

### 1.1 本周核心数据

| 指标 | 数值 | 环比变化 | 评价 |
|------|------|----------|------|
| 资产总值 | ¥X,XXX.XX | 📈/📉 +X.X% | 🟢优秀/🟡一般/🔴警戒 |
| 固定资产 | ¥X,XXX.XX | 📈/📉 +X.X% | 状态评价 |
| 虚拟资产 | ¥X,XXX.XX | 📈/📉 +X.X% | 状态评价 |
| 本周收入 | ¥X,XXX.XX | 📈/📉 +X.X% | 收入表现 |
| 利用率 | XX.X% | ↗️/↘️ +X.X% | 效率评价 |
| 浪费率 | XX.X% | ↗️/↘️ +X.X% | 风险评价 |

### 1.2 关键发现 🔍

**🎯 最重要的3个发现**:
1. 🔴/🟡/🟢 **[发现1]**: 具体描述+数据支撑
2. 🔴/🟡/🟢 **[发现2]**: 具体描述+数据支撑
3. 🔴/🟡/🟢 **[发现3]**: 具体描述+数据支撑

**⚠️ 需立即关注**: 
- 列出需要紧急处理的问题(如果有)

---

## 🏠 二、固定资产深度分析

### 2.1 整体概览

```
资产数量: XX项 | 原始总值: ¥XX,XXX | 当前总值: ¥XX,XXX | 折旧率: XX%
本周收入: ¥XX,XXX | 收入占比: XX% | 状态分布: 在用XX项/闲置XX项
```

**💡 专业点评**:
- [对固定资产整体状况的专业评价,2-3句话]
- [指出优势或问题,结合具体数据]

### 2.2 分类明细分析

**📊 各类资产表现**:

| 资产类别 | 数量 | 当前价值 | 占比 | 收入贡献 | 表现评级 |
|----------|------|----------|------|----------|----------|
| [类别1] | X项 | ¥X,XXX | XX% | ¥XXX | 🟢/🟡/🔴 |
| [类别2] | X项 | ¥X,XXX | XX% | ¥XXX | 🟢/🟡/🔴 |
| ... | ... | ... | ... | ... | ... |

**🎯 重点资产点评**:

1. **表现最好**: [类别名称]
   - ✅ 亮点: [具体说明为什么表现好]
   - 💰 收入: ¥XXX ([占比XX%])
   - 📝 建议: [如何保持或提升]

2. **需要关注**: [类别名称]
   - ⚠️ 问题: [具体问题描述]
   - 📊 数据: [支撑数据]
   - 💡 建议: [具体改进措施,可执行]

### 2.3 收入结构分析

**💵 本周收入构成**:

```
总收入: ¥X,XXX.XX
├─ 租金收入: ¥XXX (XX%) 📈/📉 环比±XX%
├─ 增值收入: ¥XXX (XX%) 📈/📉 环比±XX%
├─ 其他收入: ¥XXX (XX%) 📈/📉 环比±XX%
└─ ...
```

**💡 收入分析与建议**:
- [分析收入结构是否合理]
- [指出收入增长点或风险点]
- [提供增收建议,具体可行]

### 2.4 资产健康度诊断

**🏥 健康度指标**:
- 折旧健康度: ⭐⭐⭐⭐⭐ (X/5星) - [说明]
- 使用效率: ⭐⭐⭐⭐⭐ (X/5星) - [说明]
- 收入能力: ⭐⭐⭐⭐⭐ (X/5星) - [说明]

**📋 问题清单**:
- 🔴 严重: [如果有,列出严重问题]
- 🟡 注意: [如果有,列出需要注意的问题]
- 🟢 正常: [正常运行的项目数]

---

## 💎 三、虚拟资产深度分析

### 3.1 整体概览

```
项目总数: XX个 | 总投入: ¥XX,XXX | 剩余价值: ¥XX,XXX
利用率: XX.X% | 浪费率: XX.X% | 活跃项目: XX个 | 已过期: XX个
```

**💡 专业点评**:
- [对虚拟资产利用情况的评价]
- [指出效率高低,结合行业标准]

### 3.2 利用率分析

**📊 利用率分布**:

| 利用区间 | 项目数 | 占比 | 代表项目 | 状态 |
|----------|--------|------|----------|------|
| 90%-100% | X个 | XX% | [项目名] | 🟢 优秀 |
| 70%-90% | X个 | XX% | [项目名] | 🟢 良好 |
| 50%-70% | X个 | XX% | [项目名] | 🟡 一般 |
| <50% | X个 | XX% | [项目名] | 🔴 较差 |

**💡 效率提升建议**:
- [针对低利用率项目的具体建议]
- [如何提高整体利用率]

### 3.3 浪费分析

**⚠️ TOP5 浪费项目**:

| 排名 | 项目名称 | 浪费金额 | 浪费率 | 原因分析 | 建议措施 |
|------|----------|----------|--------|----------|----------|
| 1 | [项目1] | ¥XXX | XX% | [原因] | [建议] |
| 2 | [项目2] | ¥XXX | XX% | [原因] | [建议] |
| ... | ... | ... | ... | ... | ... |

**💰 浪费原因分类**:
1. **购买不当** (¥XXX, XX%): [具体说明]
2. **使用不足** (¥XXX, XX%): [具体说明]
3. **过期未用** (¥XXX, XX%): [具体说明]

**💡 止损建议**:
- [立即可执行的止损措施]
- [长期避免浪费的策略]

### 3.4 过期风险预警

**⏰ 即将过期项目** (7天内):

| 项目名称 | 剩余天数 | 剩余价值 | 利用情况 | 建议行动 |
|----------|----------|----------|----------|----------|
| [项目1] | X天 | ¥XXX | XX% | 🔴 立即使用/🟡 加速使用 |
| ... | ... | ... | ... | ... |

**总风险**: ¥X,XXX 可能浪费

**🚨 紧急行动**:
- [具体的使用建议,带时间表]

---

## 📈 四、趋势分析与对比

### 4.1 周环比变化

**核心指标变化**:

```
资产总值: ¥XX,XXX → ¥XX,XXX (📈/📉 ±X.X%)
  ├─ 固定资产: 📈/📉 ±X.X% [变化原因]
  └─ 虚拟资产: 📈/📉 ±X.X% [变化原因]

收入表现: ¥XX,XXX → ¥XX,XXX (📈/📉 ±X.X%)
  └─ 变化原因: [分析]

效率指标:
  ├─ 利用率: XX% → XX% (↗️/↘️ ±X.X%)
  └─ 浪费率: XX% → XX% (↗️/↘️ ±X.X%)
```

**💡 趋势解读**:
- [对变化趋势的专业解读]
- [是否符合预期,是否需要调整]

### 4.2 本周亮点 ✨

1. **[亮点1标题]** 🎉
   - 成果: [具体成果+数据]
   - 价值: [带来的价值]
   - 经验: [可复制的经验]

2. **[亮点2标题]** 🎉
   - [同上]

### 4.3 本周问题 ⚠️

1. **[问题1标题]** 🔴
   - 现象: [具体问题描述]
   - 影响: [造成的影响+数据]
   - 根因: [深层原因分析]
   - 对策: [具体解决方案,分步骤]

2. **[问题2标题]** 🟡
   - [同上]

---

## 🎯 五、行动计划与建议

### 5.1 下周优先级任务

**🔴 高优先级** (必须完成):
1. **[任务1]**
   - 目标: [具体目标]
   - 行动: [具体步骤]
   - 预期: [预期效果]
   - 截止: [时间]

2. **[任务2]**
   - [同上]

**🟡 中优先级** (尽量完成):
1. **[任务1]**: [简要说明]
2. **[任务2]**: [简要说明]

**🟢 低优先级** (有时间再做):
- [任务列表]

### 5.2 长期优化建议

**📊 资产配置优化**:
- [资产结构调整建议]
- [投资方向建议]

**💰 收入提升路径**:
- [短期增收措施]
- [长期收入增长策略]

**⚡ 效率改进方案**:
- [提高利用率的方法]
- [减少浪费的策略]

### 5.3 风险提示

**⚠️ 需要关注的风险点**:
1. [风险1]: [描述+影响+应对]
2. [风险2]: [描述+影响+应对]

---

## 📊 六、数据可视化说明

下方图表展示了本周关键数据的可视化分析:

- **资产配置饼图**: 展示固定资产与虚拟资产的价值占比分布
- **健康评分雷达图**: 从多维度评估资产健康状况(满分100)
- **固定资产分类柱状图**: 各类固定资产的价值分布对比
- **虚拟资产利用率表格**: 详细展示各类虚拟资产的利用效率

**💡 图表解读要点**:
- [指出图表中最值得关注的数据]
- [图表反映的问题或机会]

---

## 📝 七、总结与展望

**本周总结** (一句话):
[用一句话总结本周资产管理的整体情况]

**下周展望**:
- 预期目标: [具体目标]
- 关注重点: [重点关注事项]
- 期待改善: [期待改善的指标]

---

**报告生成时间**: {generate_time}  
**分析系统**: TimeValue AI 资产管理系统  
**技术支持**: 智谱AI GLM-4 大模型  
**分析师**: AI 智能财富顾问

---

**📌 阅读提示**:
- 🔴 表示需要立即关注的问题
- 🟡 表示需要注意的事项
- 🟢 表示良好的表现
- 📈 表示上升趋势
- 📉 表示下降趋势
- ⭐ 表示评级星级

**输出要求**:
1. 使用Markdown格式,严格按照上述结构输出
2. 所有数据必须真实,来自提供的数据源
3. 每个章节都要有具体数据支撑,不要空洞
4. 点评和建议必须专业、具体、可执行
5. 大量使用emoji提升可读性
6. 重要数字、关键词用**加粗**
7. 善用表格、代码块、引用块来组织信息
8. 不要输出```markdown```标记
9. 直接返回完整的Markdown文本
10. 分析要深入,颗粒度要细,建议要实用

请生成周报:"""


def get_monthly_report_prompt(data_text):
    """获取月报生成提示词"""
    weekly_prompt = get_weekly_report_prompt(data_text)
    return weekly_prompt.replace("周报", "月报").replace("本周", "本月").replace("上周", "上月").replace("下周", "下月")


def get_yearly_report_prompt(data_text):
    """获取年报生成提示词"""
    weekly_prompt = get_weekly_report_prompt(data_text)
    return weekly_prompt.replace("周报", "年报").replace("本周", "本年").replace("上周", "上年").replace("下周", "明年")


def get_chart_data_prompt(ai_analysis_result):
    """
    根据AI分析结果,生成图表数据的提示词
    
    Args:
        ai_analysis_result: AI分析的JSON结果
    """
    return f"""基于以下分析结果,生成前端图表所需的数据配置。

===== AI分析结果 =====
{ai_analysis_result}

===== 需要生成的图表 =====

请返回一个JSON对象,包含以下图表的数据配置:

{{
    "asset_allocation_pie": [
        {{"name": "固定资产", "value": 数值}},
        {{"name": "虚拟资产", "value": 数值}}
    ],
    
    "fixed_asset_categories_bar": [
        {{"category": "分类名", "value": 价值, "count": 数量}}
    ],
    
    "virtual_asset_utilization_gauge": {{
        "utilization_rate": 利用率百分比,
        "waste_rate": 浪费率百分比
    }},
    
    "income_structure_pie": [
        {{"source": "来源", "amount": 金额}}
    ],
    
    "health_score_radar": [
        {{"dimension": "固定资产", "score": 得分, "maxScore": 100}},
        {{"dimension": "虚拟资产", "score": 得分, "maxScore": 100}},
        {{"dimension": "收入表现", "score": 得分, "maxScore": 100}},
        {{"dimension": "风险控制", "score": 得分, "maxScore": 100}}
    ]
}}

**要求**:
1. 所有数值必须是数字类型,不是字符串
2. 百分比不要带%符号,直接数字(如 75 不是 "75%")
3. 确保JSON格式正确
4. 不要输出代码块标记

请生成图表数据配置:"""
